<!DOCTYPE html>
<html lang="de" class="h-100">

<head>
  <%0- _HEAD %0>
</head>

<body class="d-flex flex-column h-100 <%2 if(con.isDarkTheme){ %2>dark-body text-light<%2 } %2>">
  <%0- _HEADER %0>

  <main style="margin-bottom: 2rem">
    <div class="container">
      <%0- _SEARCH %0>
      <br>

      <div class="row row-equal">
        <div class="col-md-3">
          <div class="card-skin text-dark text-center">
            <button type="button" class="btn btn-outline-success btn-sm" style="margin-right: .5rem;" onclick="toggle3d(this)">3D</button><!--
            --><button type="button" class="btn btn-outline-success btn-sm" onclick="toggle2nd(this)">2nd</button>
            <br><br>

            <img class="img-fluid mx-auto d-block" id="skin3D" alt="Rendered Minecraft skin"
              src="https://api.sprax2013.de/mc/skin/x-url/body/3d?size=180&url=https://cdn.skindb.net/skins/<%2= page.skin.skin.id %2>">

            <hr>  <!-- TODO: remove debug -->
            <img alt="original (raw) Minecrat skin" src="https://cdn.skindb.net/skins/<%2= page.skin.skin.id %2>">  <!-- TODO: remove debug -->

            <hr>

            <ul class="list-inline text-center">
              <li class="list-inline-item">
                <i class="material-icons" aria-hidden="true">list</i> ? <!-- TODO -->
              </li>

              <li class="list-inline-item">
                <i class="material-icons" aria-hidden="true">star</i> ? <!-- TODO -->
              </li>

              <li class="list-inline-item">
                <i class="material-icons" aria-hidden="true">people</i> ? <!-- TODO -->
              </li>
            </ul>
          </div>
        </div>

        <div class="col-1 d-none d-md-block"></div>

        <div class="col">
          <div>
            <div class="card-white text-dark">
              <div class="card-title">
                <h3>Tags</h3>
              </div>
              <hr class="w-95">

              <div class="card-content">
                <%2 if(page.skin.tags.length == 0 && page.skin.aiTags.length == 0 && page.skin.tagVotes.length == 0) { -%2>
                  <p><i>No tags have been added to this skin yet.</i></p>
                <%2 } -%2>

                <!-- TODO: Prepare search instead of redirect -->
                <!-- TODO: Make sure users understand what the colors on the tags mean! -->
                <%2 for (const tag of page.skin.tags) { -%2>
                  <!-- TODO: onHover: Show report button so users can say they don't agree with this tag -->
                  <a href="<%0- global.url.base %0>/search?q=<%2= tag.name %2>" class="btn button-tag a-stealth bg-lightgreen"><%2= tag.name %2></a>
                <%2 } -%2>

                <%2 for (const tag of page.skin.aiTags) { -%2>
                  <%0 // TODO: Reduce duplicate code! %0>
                  <%2 const vote = page.skin.profileVotes ? page.skin.profileVotes.find((value) => value.id == tag.id) : undefined; %2>
                  <%2 const btnClassUp = vote && vote.vote ? 'icon-green' : 'hover-green'; %2>
                  <%2 const btnClassDown = vote && !vote.vote ? 'icon-red' : 'hover-red'; %2>
                  <%2 const inputValueUp = vote && vote.vote ? 'unset' : 'on'; %2>
                  <%2 const inputValueDown = vote && !vote.vote ? 'unset' : 'off'; %2>

                  <%2 const sumClass = tag.sum == 0 ? '' : (tag.sum > 0 ? 'text-success' : 'text-danger'); %2>
                  <%2 const sumStr = `<span class="${sumClass}"> ${tag.sum == 0 ? '±' : (tag.sum > 0 ? '+' : '')}${tag.sum}</span>`; %2>

                  <a href="<%0- global.url.base %0>/search?q=<%2= tag.name %2>" class="btn button-tag a-stealth bg-lavenderblush">
                    <%2= tag.name %2> <%2- sumStr %2>

                    <div clas="row" style="float: right">
                      <form method="POST" action="<%2= con.url %2>/vote" style="height: calc(1.5em + .5rem + 2px);margin: -8px;float: left"
                        <%2 if(!con.isLoggedIn) { %2>data-toggle="tooltip" data-placement="top" title="You need to be logged in!"<%2 } %2>>
                        <button type="submit" class="btn a-stealth text-center" <%2 if(!con.isLoggedIn) { %2>onclick="event.preventDefault()"<%2 } %2>><span class="material-icons <%2- btnClassUp %2>">thumb_up</span></button>

                        <input type="text" name="tag" value="<%2= tag.name %2>" hidden readonly>
                        <input type="checkbox" name="vote" value="<%2= inputValueUp %2>" checked hidden readonly>
                      </form>

                      <form method="POST" action="<%2= con.url %2>/vote" style="height: calc(1.5em + .5rem + 2px);margin: -8px;float: right"
                        <%2 if(!con.isLoggedIn) { %2>data-toggle="tooltip" data-placement="top" title="You need to be logged in!"<%2 } %2>>
                        <button type="submit" class="btn a-stealth text-center" <%2 if(!con.isLoggedIn) { %2>onclick="event.preventDefault()"<%2 } %2>><span class="material-icons <%2- btnClassDown %2>">thumb_down</span></button>

                        <input type="text" name="tag" value="<%2= tag.name %2>" hidden readonly>
                        <input type="checkbox" name="vote" value="<%2= inputValueDown %2>" checked hidden readonly>
                      </form>
                    </div>
                  </a>
                <%2 } -%2>

                <%2 for (const tag of page.skin.tagVotes) { -%2>
                  <%2 const vote = page.skin.profileVotes ? page.skin.profileVotes.find((value) => value.id == tag.id) : undefined; %2>
                  <%2 const btnClassUp = vote && vote.vote ? 'icon-green' : 'hover-green'; %2>
                  <%2 const btnClassDown = vote && !vote.vote ? 'icon-red' : 'hover-red'; %2>
                  <%2 const inputValueUp = vote && vote.vote ? 'unset' : 'on'; %2>
                  <%2 const inputValueDown = vote && !vote.vote ? 'unset' : 'off'; %2>

                  <%2 const sumClass = tag.sum == 0 ? '' : (tag.sum > 0 ? 'text-success' : 'text-danger'); %2>
                  <%2 const sumStr = `<span class="${sumClass}"> ${tag.sum == 0 ? '±' : (tag.sum > 0 ? '+' : '')}${tag.sum}</span>`; %2>

                  <a href="<%0- global.url.base %0>/search?q=<%2= tag.name %2>" class="btn button-tag a-stealth bg-???">
                    <%2= tag.name %2> <%2- sumStr %2>

                    <div clas="row" style="float: right">
                      <form method="POST" action="<%2= con.url %2>/vote" style="height: calc(1.5em + .5rem + 2px);margin: -8px;float: left"
                        <%2 if(!con.isLoggedIn) { %2>data-toggle="tooltip" data-placement="top" title="You need to be logged in!"<%2 } %2>>
                        <button type="submit" class="btn a-stealth text-center"<%2 if(!con.isLoggedIn) { %2>onclick="event.preventDefault()"<%2 } %2>><span class="material-icons <%2- btnClassUp %2>">thumb_up</span></button>

                        <input type="text" name="tag" value="<%2= tag.name %2>" hidden readonly>
                        <input type="checkbox" name="vote" value="<%2= inputValueUp %2>" checked hidden readonly>
                      </form>

                      <form method="POST" action="<%2= con.url %2>/vote" style="height: calc(1.5em + .5rem + 2px);margin: -8px;float: right"
                        <%2 if(!con.isLoggedIn) { %2>data-toggle="tooltip" data-placement="top" title="You need to be logged in!"<%2 } %2>>
                        <button type="submit" class="btn a-stealth text-center" <%2 if(!con.isLoggedIn) { %2>onclick="event.preventDefault()"<%2 } %2>><span class="material-icons <%2- btnClassDown %2>">thumb_down</span></button>

                        <input type="text" name="tag" value="<%2= tag.name %2>" hidden readonly>
                        <input type="checkbox" name="vote" value="<%2= inputValueDown %2>" checked hidden readonly>
                      </form>
                    </div>
                  </a>
                <%2 } -%2>

                <div class="hover-box" <%2 if(!con.isLoggedIn) { %2>data-toggle="tooltip" data-placement="top" title="You need to be logged in!"<%2 } %2>>
                  <form method="POST" action="<%2= con.url %2>/vote">
                    <button type="submit" class="btn a-stealth text-center"><span class="material-icons">add</span></button><!--
                    --><input type="text" name="tag" placeholder="Add new tag" required <%2 if(!con.isLoggedIn) { %2>hidden<%2 } %2>>
                    <input type="checkbox" name="vote" value="on" checked hidden readonly>
                  </form>
                </div>
              </div>
            </div>

            <div class="card-white text-dark">
              <div class="card-title">
                <h3>Öffentlichen Listen (0 Private)</h3>
              </div>
              <hr class="w-95">

              <div class="card-content">
                <i>In keiner Liste verwendet</i>
              </div>
            </div>

            <div class="card-white text-dark">
              <div class="card-title">
                <h3>Spieler, die mit diesem Skin gesehen wurden</h3>
              </div>
              <hr class="w-95">

              <!-- TODO: Make div scrollable and don't show all users by default -->
              <!-- TODO: Show Profile-Card onHover -->
              <div class="card-content" style="max-height: 150px; overflow-y: auto">
                <%2- page.skin.seenOn.map((el) => { return `<a href="<%0- global.url.base %0>/account/${el.id}">${el.name}</a>`; }).join(',\n                '); %2>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <%0- _FOOTER %0>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      update3dSkin('<%2= page.skin.skin.id %2>');

      // <%2 if(!con.isLoggedIn) { %2>
      $(() => {
        $('[data-toggle="tooltip"]').tooltip();
      });
      // <%2 } %2>
    });
  </script>
</body>

</html>